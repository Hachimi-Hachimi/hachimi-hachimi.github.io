# はじめに

## ⚠️ このウェブサイトやGitHubリポジトリへのリンクを貼らないでください
Hachimi をより多くの人に知ってもらい、より多くの人に快適なゲームプレイができるようになってほしい、という気持ちはわかります。
しかし、このプロジェクトはゲームの利用規約に本質的に違反しているため、もし開発元がこのプロジェクトの存在を知ったら、間違いなく削除しようとするでしょう。

プライベートなチャット等での共有は構いませんが、このプロジェクトや関連ツールのリンクを、不特定多数が閲覧できるウェブサイト上で共有するのはお控えください。

### どうしても共有する場合
検索エンジンによる解析を避けるため、ゲームの正式名称の代わりに「UM:PD」や「The Honse Game」といった名称で呼ぶようにお願いします。

## 互換性

インストールをする前に、互換性を確認してください。

### Windows
| バージョン | 対応状況 |
| --- | :---: |
| DMM 日本語版（JP） | ✅ |
| Steam 日本語版 (JP) | ❌ |
| 韓国語版（KR） | ❌ |
| グローバル版 | ✅ |

### Android

| バージョン | 通常インストール | 直接インストール | Zygisk |
| --- | :---: | :---: | :---: |
| 日本語版（JP） | ✅ | ✅ | ✅ |
| 韓国語版（KR） | ❌ | ❌ | ❌ |
| 繁体字中国語 Google Play版（TW GP） | ⚠️ | ⚠️ | ✅ |
| 繁体字中国語 MyCard版（TW MC） | ⚠️ | ⚠️ | ✅ |
| 簡体字中国語版 | ⚠️ | ⚠️ | ✅ |
| グローバル版 | ⚠️ | ⚠️ | ❔ |
- ✅ - 完全にサポートされています。
- ⚠️ - 動作可能ですが、ゲーム自体が（アンチチートなど外的要因のため）正常にプレイできません。
- ❔ - 未検証。動作する可能性はありますが、期待はしないでください。
- ❌ - サポートされていません。


## インストール方法

インストール方法はゲームのバージョンによって異なります。いずれかのバージョンをクリックしてご確認ください。

<details>
<summary style="font-size: 20px; font-weight: 600;">日本語版</summary>

### Windows

v0.13.0の時点では、インストールする方法は2つあります。
**インストーラーを使うか、手動でやるか、どちらか1つだけの方法を選んでください。複数の方法を同時に使用しないでください。**

#### 方法 1:「.local」フォルダを使った DLL リダイレクト（UnityPlayer.dll 用）（推奨）

::: warning
Vanguardなどの一部のアンチチートは、保護対象のゲームに直接影響を与えない場合でも、システム上で DLL リダイレクトが有効になっている場合、それを良くないこととみなす可能性があります。Vanguardや、同様のチェックを行う他のアンチチートを使用しているゲームをプレイする際には、必ず DLL リダイレクトを無効にしてください。
:::

::: info
インストール後にゲームが起動しない場合は、ゲームがインストールされているフォルダに行き、ゲームの exe ファイルを右クリックし、プロパティを開き、 **「全画面表示の最適化を無効にする」** オプションを有効化してください。
:::

- **インストーラーの使い方:** 最新バージョンの `hachimi_installer.exe` を[リリースページ](https://github.com/Hachimi-Hachimi/Hachimi/releases)からダウンロードし、実行します。 そして **"UnityPlayer.dll" as the target（「UnityPlayer.dll」をターゲットにする）** を選択し、「install」をクリックします。

初めてインストールする際に、インストーラーが .local フォルダを使った DLL リダイレクトを有効にするように確認する場合があります。「OK」をクリックすると有効になります。**動作させるためには、有効にした後、コンピューターを再起動する必要があります。**

- **手動でやる場合**
1. [こちらの記事](https://learn.microsoft.com/ja-jp/windows/win32/dlls/dynamic-link-library-redirection#optional-configure-the-registry)の「レジストリを構成する」を参考にし、 DLL リダイレクトを有効にしてから、コンピューターを再起動します。
2. 最新バージョンの `hachimi.dll` を[リリースページ](https://github.com/Hachimi-Hachimi/Hachimi/releases)からダウンロードします。
3. ゲームがインストールされているフォルダ内に `umamusume.exe.local` という名前の新しいフォルダを作成して、ダウンロードした DLL ファイルをそこに移動し、ファイル名を `UnityPlayer.dll` に変更します。
4. 最新バージョンの `cellar.dll` を[Cellarのリリースページ](https://github.com/Hachimi-Hachimi/Cellar/releases)からダウンロードします。
5. ダウンロードしたファイルを `umamusume.exe.local` フォルダに移動し、`apphelp.dll` に名前を変更してください。

::: info
LoLやValorantをプレイしたい方へ：これらのゲームをプレイするたびに、 DLL リダイレクトを無効にする必要があります。こちらのプログラムを使えば、簡単に有効化や無効化ができます：https://github.com/LeadRDRK/DotLocalToggle/releases プログラムを実行し、 DLL リダイレクトが無効化されたと表示されたら、コンピューターを再起動してください。
:::

#### 方法 2: プラグインのシミング（cri_mana_vpx.dll）

::: warning
この方法は、最近のアップデートにより使用ができなくなりました。方法 1に移行する場合は、以下のガイドに従ってください。
:::

#### 方法 2から 方法 1に移行する
方法 2から方法 1に移行することはできますが、逆の場合よりも少し難しいです (方法 1 → 方法 2の場合は、アンインストールして再インストールするだけです)。
まず、Shinmy を完全にアンインストールする必要があります。 DMM を終了しても Shinmy は最大30秒間起動し続け、その間であれば自動的に復元されるため、削除する際には Shinmy が起動していないことを確認してください。**一番簡単な方法はインストーラーを使用することです**（アンインストーラーとしても動作するため）。インストーラーを使用すると、すべてが自動的にクリーンアップされます。


これらの手順が終わったあとは、Hachimi を通常通りアンインストールできます。

### Android

一番簡単な方法は[ウマPatcher](https://github.com/LeadRDRK/UmaPatcher)（APK を編集するアプリ）を使用することです。ゲームがまだインストールされていない場合に推奨です。

::: danger
すでにゲームをインストールしている場合、パッチ適用済みのものを初めてインストールする前にアンインストールする必要があります。その後は、別のパッチ適用済みのものをインストールすることで、ゲームのアンインストールをせずにアップデートすることができます。
:::

::: danger
APKPure からダウンロードした APK は使用しないでください。不具合の発生が報告されています。
:::

1. 最新バージョンのウマPatcherを[リリースページ](https://github.com/LeadRDRK/UmaPatcher/releases)からダウンロードし、インストールします。
2. ゲームのインストールパッケージを準備します。パッケージの形式は以下のとおりです。
    - **分割 APK ファイル**: ベース APK ファイルと、いずれか1つの分割構成 APK ファイル（例: config.arm64_v8a、config.armeabi-v7aなど）です。
	お使いの端末に適した構成 APK ファイルを1つ選択してください。
	これは現在、日本語版でのみ使用されています。
    - **単一 APK ファイル**: すべての構成を含んだフルサイズの APK ファイルです。
    - **XAPK ファイル**: 分割 APK ファイルを ZIP 形式でまとめ、拡張子を XAPK に変更したファイルです。

   分割 APK ファイル、および XAPK ファイルは[Qoopy](https://qoopy.leadrdrk.com/)を使用してダウンロードできます。ID は「6172」です。
3. ウマPatcher を起動して、「Normal install」を選び、準備したファイル（単一または複数）を選択します。
4. 「Patch」をタップすると、パッチ適用とインストールが行われます。

アプリがアップデートされるたびに、ステップ2からやり直す必要があります。

#### ルート化済みのユーザーの場合
ウマPatcher にはルート化済みのユーザーのためのインストールオプションがあり、ゲームをアンインストールすることなく、アプリストアから通常通りアップデートできます。

ゲームをインストールしたら、ホーム画面上部のカードをタップして、パッチを適用したいアプリ（必要な場合）を選択します。インストール方法として「Direct install」を選択し、「Patch」をタップします。ファイルを選択する必要はありません。

アプリがアップデートされるたびに、再度インストールする必要があります。

#### 手動でやる場合
1. ビルドをするか、ビルド済みライブラリを[リリースページ](https://github.com/Hachimi-Hachimi/Hachimi/releases)からダウンロードします。
2. ゲームの APK ファイルを抽出します。[apktool](https://apktool.org/)を使用することをお勧めします。
3. `lib` フォルダ内の各フォルダにある `libmain.so` ファイルの名前を `libmain_orig.so` に変更します。
4. プロキシライブラリを対応するフォルダにコピー（例： `libmain-arm64-v8a.so` は `lib/arm64-v8a` にコピー）し、名前を `libmain.so` に変更します。
5. APK ファイルをビルドし、インストールします。

</details>

<details>
<summary style="font-size: 20px; font-weight: 600;">グローバル版 / 繁体中国語版 / 簡体字中国語版</summary>

### Windows

- インストーラーを使う方法: 最新の `hachimi_installer.exe` を[リリースページ](https://github.com/Hachimi-Hachimi/Hachimi-Unity2020/releases)からダウンロードして起動し、インストールボタンをクリックします。どのように動作するかがよくわからない場合は、オプションを変更しないでください。
- 手動でやる方法: 最新の `hachimi.dll` を[リリースページ](https://github.com/Hachimi-Hachimi/Hachimi-Unity2020/releases)からダウンロードした後、ファイルをゲームのインストールフォルダに移動し、ファイル名を `winhttp.dll`、`version.dll`、`opengl32.dll` のいずれかに変更します。

### Android

::: warning
これらのバージョンは、ルート権限なしでは Hachimi を使用できません。
:::

#### Zygisk
最新の Zygisk の zip ファイルを[リリースページ](https://github.com/Hachimi-Hachimi/Hachimi-Unity2020/releases)からダウンロードし、Magisk または KernelSU（Zygisk Next と併用）でインストールしてください。

</details>


## 初期セットアップ
Hachimi をインストールした後、初めてゲームを起動すると、次のダイアログが表示されます。

![First Time Setup](/assets/first-time-setup.jpg)

*もし表示されない場合は、Hachimi が正しくインストールされていない可能性があります。インストール方法をご確認の上、もう一度お試しください。*

「Next」をタップして翻訳リポジトリを選択してください。「Done」をタップすると設定が保存され、アップデートのチェックが開始されます。

その後、翻訳のアップデートをダウンロードするように要求されます。「Yes」をクリックして、翻訳ファイルのダウンロードを開始します。